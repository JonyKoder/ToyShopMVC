@model List<ToyViewModel>

@{
    ViewData["Title"] = "HandWork";
}
<style>


    .centered {
        text-align: center;
        vertical-align: middle;
    }

    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        padding: 12px 16px;
        z-index: 1;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    .buttonChange{
        width: 100px;
        border-radius: 30px;
        background-color: blue;
        color: white;
       
    }
</style>
<div class="text-center">
    <a asp-controller="Home" asp-action="Create">Добавить товар</a>
    <table>
        <tr>
            <th>Фото</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Цена</th>
            <th>Действия</th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td class="centered">
                    <img src="@Url.Action("GetImage", "Home", new { imagePath = item.Image })" alt="Фото отсутствует" width="250px" height="150px" />
                </td>
                <td class="centered">
                    @item.Name
                </td>
                <td class ="centered">
                    @item.Description
                </td>
                <td class ="centered">
                    @item.Price Р
                </td>
                <td class="centered">
                    <div class="dropdown">
                        <button class="buttonChange">Действия</button>
                        <div class="dropdown-content">
                            <a asp-controller="Home" asp-action="Edit" asp-route-id="@item.Id">Редактировать</a>
                            <a asp-controller="Home" asp-action="Delete" asp-route-id="@item.Id" onclick="confirmDeletion(event, this)">Удалить</a>
                            <a asp-controller="Home" asp-action="AddToyInCart" asp-route-id="@item.Id">Добавить в корзину</a>
                        </div>
                    </div>
                </td>
            </tr>
        }

    </table>
</div>
<script>
    async function confirmDeletion(event, element) {
        event.preventDefault(); // Отменить переход по ссылке

        const url = element.href; // Получить URL

        const confirmation = confirm("Вы уверены, что хотите удалить этот элемент?");

        if (confirmation) {
            try {
                const response = await fetch(url, { method: "POST" });

                if (response.ok) {
                    alert("Элемент успешно удален.");
                    window.location.reload(); // Перезагрузить страницу (если требуется обновление данных на экране)
                } else {
                    alert("Произошла ошибка при удалении элемента.");
                }
            } catch (error) {
                console.error("Ошибка при отправке запроса на удаление:", error);
                alert("Произошла ошибка при удалении элемента.");
            }
        }
    }
</script>
